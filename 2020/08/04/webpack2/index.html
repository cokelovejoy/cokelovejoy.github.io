<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>webpack2 | RICHARD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="WebpackDevServer每次改完代码都需要重新打包一次，打开浏览器，刷新一次，很麻烦。可以安装使用WebpackDevServer来改善开发效率。 安装1npm install webpack-dev-server -D  配置修改package.json 123&quot;script&quot;: &amp;#123;    &quot;server&quot;: &quot;webpack-dev-server&quot;&amp;#125;  在webpa">
<meta name="keywords" content="Python, JS, Vue, NodeJS">
<meta property="og:type" content="article">
<meta property="og:title" content="webpack2">
<meta property="og:url" content="http://yoursite.com/2020/08/04/webpack2/index.html">
<meta property="og:site_name" content="RICHARD">
<meta property="og:description" content="WebpackDevServer每次改完代码都需要重新打包一次，打开浏览器，刷新一次，很麻烦。可以安装使用WebpackDevServer来改善开发效率。 安装1npm install webpack-dev-server -D  配置修改package.json 123&quot;script&quot;: &amp;#123;    &quot;server&quot;: &quot;webpack-dev-server&quot;&amp;#125;  在webpa">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-08-31T13:01:21.603Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="webpack2">
<meta name="twitter:description" content="WebpackDevServer每次改完代码都需要重新打包一次，打开浏览器，刷新一次，很麻烦。可以安装使用WebpackDevServer来改善开发效率。 安装1npm install webpack-dev-server -D  配置修改package.json 123&quot;script&quot;: &amp;#123;    &quot;server&quot;: &quot;webpack-dev-server&quot;&amp;#125;  在webpa">
  
    <link rel="alternate" href="/atom.xml" title="RICHARD" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">RICHARD</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">RICHARD BLOG</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-webpack2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/04/webpack2/" class="article-date">
  <time datetime="2020-08-04T14:51:48.000Z" itemprop="datePublished">2020-08-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      webpack2
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="WebpackDevServer"><a href="#WebpackDevServer" class="headerlink" title="WebpackDevServer"></a>WebpackDevServer</h1><p>每次改完代码都需要重新打包一次，打开浏览器，刷新一次，很麻烦。可以安装使用WebpackDevServer来改善开发效率。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack-dev-server -D</span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>修改package.json</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"script"</span>: &#123;</span><br><span class="line">    <span class="string">"server"</span>: <span class="string">"webpack-dev-server"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在webpack.config.js配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">    contentBase: <span class="string">"./dist"</span>,</span><br><span class="line">    open: <span class="literal">true</span>,</span><br><span class="line">    port: <span class="number">8081</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run server</span><br></pre></td></tr></table></figure>

<p>启动服务后，会发现dist目录没有了，这是因为devServer把打包后的模块不会放到dist目录下，而是放到了内存中，从而提升速度。</p>
<h2 id="本地mock，解决跨域"><a href="#本地mock，解决跨域" class="headerlink" title="本地mock，解决跨域"></a>本地mock，解决跨域</h2><p>联调期间，前后端分离，直接获取数据会跨域，上线后我们使用nginx转发，开发期间，webpack就可以搞定这件事。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// npm i express -D</span></span><br><span class="line"><span class="comment">// 创建一个server.js 修改package.js中的scripts选项 "server":"node server.js"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line">app.get(<span class="string">'/api/info'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    res.json(&#123;</span><br><span class="line">        name: <span class="string">'开课吧'</span>,</span><br><span class="line">        age: <span class="number">5</span>,</span><br><span class="line">        msg: <span class="string">'welcome to kkb'</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="string">'9092'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// node server.js</span></span><br><span class="line"><span class="comment">// 通过 http://localhost:9092/api/info 获取mock数据</span></span><br></pre></td></tr></table></figure>

<h2 id="项目中安装axios工具"><a href="#项目中安装axios工具" class="headerlink" title="项目中安装axios工具"></a>项目中安装axios工具</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// npm i axios -D</span></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"><span class="comment">// 会有跨域问题</span></span><br><span class="line">axios.get(<span class="string">'http://localhost:9092/api/info'</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="修改webpack-config-js设置服务器代理"><a href="#修改webpack-config-js设置服务器代理" class="headerlink" title="修改webpack.config.js设置服务器代理"></a>修改webpack.config.js设置服务器代理</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对于/api的请求会转发到http://localhost:9092</span></span><br><span class="line">devServer: &#123;</span><br><span class="line">    ...</span><br><span class="line">    proxy: &#123;</span><br><span class="line">        <span class="string">"/api"</span>: &#123;</span><br><span class="line">            target: <span class="string">"http://localhost:9092"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="修改index-js"><a href="#修改index-js" class="headerlink" title="修改index.js"></a>修改index.js</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 请求/api/info的请求都会代理到webpack的proxy配置中下的地址中。</span></span><br><span class="line">axios.get(<span class="string">"/api/info"</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h1 id="Hot-Module-Replacement-HMR-热模块替换"><a href="#Hot-Module-Replacement-HMR-热模块替换" class="headerlink" title="Hot Module Replacement(HMR:热模块替换)"></a>Hot Module Replacement(HMR:热模块替换)</h1><p>模块热替换(Hot Module Replacement 或 HMR)是 webpack 提供的最有用的功能之一。它允许在运行时更新各种模块，而无需进行完全刷新。主要是通过以下几种方式，来显著加快开发速度：</p>
<ol>
<li>保留在完全重新加载页面时丢失的应用程序状态。</li>
<li>只更新变更内容，以节省宝贵的开发时间。</li>
<li>调整样式更加快速，几乎相当于在浏览器调试器中更改样式。</li>
</ol>
<h2 id="启动HMR"><a href="#启动HMR" class="headerlink" title="启动HMR"></a>启动HMR</h2><p>注意启动HMR后,css抽离不会生效,还有不支持contenthash, chunkhash。HMR 不适用于生产环境，这意味着它应当只在开发环境使用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置文件头部引入webpack</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置devServer</span></span><br><span class="line">devServer: &#123;</span><br><span class="line">    contentBase: <span class="string">"./dist"</span>,</span><br><span class="line">    open: <span class="literal">true</span>,</span><br><span class="line">    hot: <span class="literal">true</span>,      <span class="comment">// 启用 webpack 的模块热替换特性, 会自动刷新页面。</span></span><br><span class="line">    hotOnly: <span class="literal">true</span>   <span class="comment">// 启用 webpack 的模块热替换特性，即便某些模块不支持热更新的情况下，浏览器也不自动刷新页面，而是在控制台输出热更新失败。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加插件</span></span><br><span class="line">plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="处理JS模块HMR"><a href="#处理JS模块HMR" class="headerlink" title="处理JS模块HMR"></a>处理JS模块HMR</h2><p>启用 webpack 内置的 HMR插件后, module.hot 接口就会暴露在 index.js 中, 接下来需要在 index.js 中配置告诉 webpack 接受HMR的模块。<br>需要使用module.hot.accept来观察模块更新，从而更新。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> printMe <span class="keyword">from</span> <span class="string">'./print.js'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">    <span class="built_in">module</span>.hot.accept(<span class="string">'./print.js'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">        printMe()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string"># Babel处理ES6</span></span><br><span class="line"><span class="string">中文网站： https://www.babeljs.cn/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Babel是JavaScript编译器，能将ES6代码转换成ES5代码，让我们开发过程中放心使用JS新特性而不用担心兼容性问题。并且还可以通过插件机制根据需求灵活的扩展。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Babel在执行编译的过程中，会从项目根目录下的.babelrc 文件中读取配置。没有该文件会从loader的options处读取配置。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 安装</span></span><br><span class="line"><span class="string">babel-loader是webpack与babel的通信桥梁，不会做把es6转换成es5的工作。</span></span><br><span class="line"><span class="string">@babel/preset-env 里包含了ES6,7,8转换成ES5的转换规则，由这个包去做转换的工作。</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>bash</span><br><span class="line">npm i babel-loader @babel/core @babel/preset-env -D</span><br></pre></td></tr></table></figure>

<h2 id="配置webpack-config-js"><a href="#配置webpack-config-js" class="headerlink" title="配置webpack.config.js"></a>配置webpack.config.js</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">           &#123;</span><br><span class="line">               test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">               exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">               use: &#123;</span><br><span class="line">                   loader: <span class="string">"babel-loader"</span>,</span><br><span class="line">                   options: &#123;</span><br><span class="line">                       presets: [<span class="string">"@babel/preset-env"</span>]</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过上面的几步还不够，默认的Babel只支持let等一些基础的特性转换，Promise等一些的转换还需要借助@babel/polyfill,把ES的新特性都装进来，来弥补低版本浏览器中缺失的特性。</p>
<h2 id="引入-babel-polyfill"><a href="#引入-babel-polyfill" class="headerlink" title="引入@babel/polyfill"></a>引入@babel/polyfill</h2><p>以全局变量的方式注入进来。windows.Promise,它会造成全局对象的污染。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 安装</span></span><br><span class="line">npm install -S @babel/polyfill</span><br><span class="line"></span><br><span class="line"><span class="comment">// 入口文件index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"@babel/polyfill"</span></span><br></pre></td></tr></table></figure>

<h2 id="按需加载，减少冗余"><a href="#按需加载，减少冗余" class="headerlink" title="按需加载，减少冗余"></a>按需加载，减少冗余</h2><p>引入babel/polyfill后,打包的体积大了很多，这是因为polyfill默认会把所有特性注入进来。然而我们期望只有用到ES6+的特性才会注入，没有用到的特性不注入，从而减少打包的体积。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改webpack.config.js</span></span><br><span class="line"></span><br><span class="line">options: &#123;</span><br><span class="line">    preset: [</span><br><span class="line">        [</span><br><span class="line">            <span class="string">"@babel/preset-env"</span>,</span><br><span class="line">            &#123;</span><br><span class="line">                targets: &#123;</span><br><span class="line">                    edge: <span class="string">"17"</span>,</span><br><span class="line">                    firefox: <span class="string">"60"</span>,</span><br><span class="line">                    chrome: <span class="string">"67"</span>,</span><br><span class="line">                    safari: <span class="string">"11.1"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                corejs: <span class="number">2</span>,            <span class="comment">// 新版本需要指定核心版本库</span></span><br><span class="line">                useBuiltIns: <span class="string">"usage"</span> <span class="comment">// 按需注入</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>useBuiltIns选项是babel 7 的新功能，这个选项告诉babel如何配置@babel/polyfill。它有三个参数可以使用： </p>
<ol>
<li>entry：需要在webpack的入口文件里import “@babel/polyfill”一次。babel会根据你的使用情况导入垫片,没有使用的功能不会被导入相应的垫片。</li>
<li>usage：不需要import，全自动检测，但是要安装@babel/polyfill 。(试验阶段)</li>
<li>false: 如果你 import”@babel/polyfill” ,它不会排除掉没有用到的垫片,程序体积会庞大。(不推荐)</li>
</ol>
<p>请注意: usage 的行为类似 babel-transform-runtime,不会造成全局污染,因此也不会对类似 Array.prototype.includes() 进行 polyfill。</p>
<h2 id="使用-babelrc文件"><a href="#使用-babelrc文件" class="headerlink" title="使用.babelrc文件"></a>使用.babelrc文件</h2><p>新建.babelrc文件。把options部分移入到该文件中，就可以了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .babelrc</span></span><br><span class="line">&#123;</span><br><span class="line">    preset: [</span><br><span class="line">        [</span><br><span class="line">            <span class="string">"@babel/preset-env"</span>,</span><br><span class="line">            &#123;</span><br><span class="line">                targets: &#123;</span><br><span class="line">                    edge: <span class="string">"17"</span>,</span><br><span class="line">                    firefox: <span class="string">"60"</span>,</span><br><span class="line">                    chrome: <span class="string">"67"</span>,</span><br><span class="line">                    safari: <span class="string">"11.1"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                corejs: <span class="number">2</span>,            <span class="comment">// 新版本需要指定核心版本库</span></span><br><span class="line">                useBuiltIns: <span class="string">"usage"</span> <span class="comment">// 按需注入</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">    exclude： /node_modules/,</span><br><span class="line">    loader: <span class="string">"babel-loader"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="babel-plugin-transform-runtime"><a href="#babel-plugin-transform-runtime" class="headerlink" title="@babel/plugin-transform-runtime"></a>@babel/plugin-transform-runtime</h2><p>当我们开发的是组件库，工具库这些场景的时候，polyfill就不合适了，因为polyfill是注入到全局变量window下的，会污染全局环境。<br>所以推荐闭包的方式： 使用@babel/plugin-transform-runtime，它不会造成全局污染。<br>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev @babel/plugin-transform-runtime</span><br><span class="line">npm install --save @babel/runtime</span><br></pre></td></tr></table></figure>

<p>修改配置文件： 注释掉之前的presets选项，添加plugins</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">options: &#123;</span><br><span class="line">    <span class="comment">// presets: [</span></span><br><span class="line">    <span class="comment">//     [</span></span><br><span class="line">    <span class="comment">//         "@babel/preset-env",</span></span><br><span class="line">    <span class="comment">//         &#123;</span></span><br><span class="line">    <span class="comment">//             targets: &#123;</span></span><br><span class="line">    <span class="comment">//                 edge: "17",</span></span><br><span class="line">    <span class="comment">//                 firefox: "60",</span></span><br><span class="line">    <span class="comment">//                 chrome: "67",</span></span><br><span class="line">    <span class="comment">//                 safari: "11.1"</span></span><br><span class="line">    <span class="comment">//             &#125;,</span></span><br><span class="line">    <span class="comment">//             useBuiltIns: "usage",</span></span><br><span class="line">    <span class="comment">//             corejs: 2</span></span><br><span class="line">    <span class="comment">//         &#125;</span></span><br><span class="line">    <span class="comment">//     ]</span></span><br><span class="line">    <span class="comment">// ],</span></span><br><span class="line">    <span class="string">"plugins"</span>: [</span><br><span class="line">        [</span><br><span class="line">            <span class="string">"@babel/plugin-transform-runtime"</span>,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">"absoluteRuntime"</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">"corejs"</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">"helpers"</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"regenerator"</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"useESModules"</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="多页面打包通用方案"><a href="#多页面打包通用方案" class="headerlink" title="多页面打包通用方案"></a>多页面打包通用方案</h1><h2 id="webpack-config-js配置文件"><a href="#webpack-config-js配置文件" class="headerlink" title="webpack.config.js配置文件"></a>webpack.config.js配置文件</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">entry: &#123;</span><br><span class="line">    index: <span class="string">"./src/index"</span>,</span><br><span class="line">    list: <span class="string">"./src/list"</span>,</span><br><span class="line">    detail: <span class="string">"./src/detail"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> htmlWebpackPlugins(&#123;</span><br><span class="line">    title: <span class="string">"index.html"</span>,</span><br><span class="line">    template: path.join(__dirname, <span class="string">"./src/index/index.html"</span>),</span><br><span class="line">    filename: <span class="string">"index.html"</span>,</span><br><span class="line">    chunks: [index]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">new</span> htmlWebpackPlugins(&#123;</span><br><span class="line">    title: <span class="string">"list.html"</span>,</span><br><span class="line">    template: path.join(__dirname, <span class="string">"./src/list/index.html"</span>),</span><br><span class="line">    filename: <span class="string">"list.html"</span>,</span><br><span class="line">    chunks: [list]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">new</span> htmlWebpackPlugins(&#123;</span><br><span class="line">    title: <span class="string">"detail.html"</span>,</span><br><span class="line">    template: path.join(__dirname, <span class="string">"./src/detail/index.html"</span>),</span><br><span class="line">    filename: <span class="string">"detail.html"</span>,</span><br><span class="line">    chunks: [detail]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="目录结构调整"><a href="#目录结构调整" class="headerlink" title="目录结构调整"></a>目录结构调整</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">    index</span><br><span class="line">        index.js</span><br><span class="line">        index.html</span><br><span class="line">    list</span><br><span class="line">        index.js</span><br><span class="line">        index.html</span><br><span class="line">    detail</span><br><span class="line">        index.js</span><br><span class="line">        index.html</span><br></pre></td></tr></table></figure>

<h2 id="使用glob-sync第三方库来匹配路径"><a href="#使用glob-sync第三方库来匹配路径" class="headerlink" title="使用glob.sync第三方库来匹配路径"></a>使用glob.sync第三方库来匹配路径</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 安装glob</span></span><br><span class="line">npm i glob -D</span><br><span class="line"><span class="comment">// MPA多页面打包通用方案</span></span><br><span class="line"><span class="comment">// webpack.config.js配置文件</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>)</span><br><span class="line"><span class="keyword">const</span> glob = <span class="built_in">require</span>(<span class="string">"glob"</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> setMPA = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> entry = &#123;&#125;</span><br><span class="line">    <span class="keyword">const</span> htmlWebpackPlugins = []</span><br><span class="line">    <span class="keyword">const</span> entryFiles = glob.sync(path.join(__dirname, <span class="string">"./src/*/index.js"</span>))</span><br><span class="line">    entryFiles.map(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> entryFile = entryFiles[index]</span><br><span class="line">        <span class="keyword">const</span> match = entryFile.match(<span class="regexp">/src\/(.*)\/index\.js$/</span>)</span><br><span class="line">        <span class="keyword">const</span> pageName = match &amp;&amp; match[<span class="number">1</span>]</span><br><span class="line">        entry[pageName] = entryFile</span><br><span class="line">        htmlWebpackPlugins.push(<span class="keyword">new</span> htmlWebpackPlugin(&#123;</span><br><span class="line">            title: pageName,</span><br><span class="line">            template: path.join(__dirname, <span class="string">`src/<span class="subst">$&#123;pageName&#125;</span>/index.html`</span>),</span><br><span class="line">            filename: <span class="string">`<span class="subst">$&#123;pageName&#125;</span>.html`</span>,</span><br><span class="line">            chunks: [pageName],</span><br><span class="line">            inject: <span class="literal">true</span></span><br><span class="line">        &#125;))</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        entry,</span><br><span class="line">        htmlWebpackPlugins</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> &#123;entry, htmlWebpackPlugins&#125; = setMpa()</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">"./dist"</span>),</span><br><span class="line">        filename: <span class="string">"[name].js"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        ...htmlWebpackPlugins <span class="comment">// 展开数组</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="文件监听"><a href="#文件监听" class="headerlink" title="文件监听"></a>文件监听</h1><p>轮询判断文件的最后编辑时间是否变化，某个文件发生了变化，并不会立刻告诉监听者，先缓存起来。<br>webpack开启监听模式的两种方式：</p>
<ol>
<li><p>命令行形式，启动监听后，需要手动刷新浏览器</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scripts: &#123;</span><br><span class="line">    <span class="string">"watch"</span>: <span class="string">"webpack --watch"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在配置文件里设置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">watch：<span class="literal">true</span>, <span class="comment">// 默认为false，不开启</span></span><br><span class="line">watchOptions： &#123;</span><br><span class="line">    ignored: <span class="regexp">/node_modules/</span>, <span class="comment">// 默认为空，不监听的文件或目录，支持正则</span></span><br><span class="line">    aggregateTimeout：<span class="number">300</span>, <span class="comment">// 监听到文件变化后，等300ms再去执行，默认300ms</span></span><br><span class="line">    poll: <span class="number">1000</span>  <span class="comment">// 判断文件是否发生变化是通过不停的询问系统指定文件有没有变化，默认每1000ms问一次</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/04/webpack2/" data-id="ckh44mzu9001b4sv2ml6x2roj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/08/07/Web-API/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Web API
        
      </div>
    </a>
  
  
    <a href="/2020/08/03/项目实战一/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">项目实战一</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DOM/">DOM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/How-to-use-hexo-create-a-blog/">How to use hexo create a blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas-基础/">canvas 基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSS/" style="font-size: 20px;">CSS</a> <a href="/tags/DOM/" style="font-size: 10px;">DOM</a> <a href="/tags/How-to-use-hexo-create-a-blog/" style="font-size: 10px;">How to use hexo create a blog</a> <a href="/tags/canvas-基础/" style="font-size: 10px;">canvas 基础</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/10/09/DOM/">DOM</a>
          </li>
        
          <li>
            <a href="/2020/10/09/CSS总结/">CSS总结</a>
          </li>
        
          <li>
            <a href="/2020/10/09/canvas基础/">canvas</a>
          </li>
        
          <li>
            <a href="/2020/10/09/设计模式/">设计模式</a>
          </li>
        
          <li>
            <a href="/2020/10/09/重识CSS/">重识CSS</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Richard.Zhao<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>