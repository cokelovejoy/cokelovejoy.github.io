---
title: 项目实战一
date: 2020-08-03 07:29:43
tags:
---
# 技术选型
1. Vue + nuxt or react + nuxt
2. 小程序， APP, H5, Node(express, koa, egg)
3. 埋点(原理+第三方), 发布(gitlab, CI/CD), 性能
4. 报错sentry, 报警(钉钉 / 微信 / 短信)
5. 其他基建(搭建, docker, 看板, 文档, 权限, 组件)
# 代码规范
## eslint
## husky
## commitizen
git 提交规范

安装
```bash
npm install -g commitizen
commitizen init cz-conventional-changelog --save-dev --save-exact
```

使用
```bash
git add xxx
git cz
```

# 文件上传知识点
## 拖拽效果和进度条显示
## 网格进度条显示切片上传的进度
## 文件类型的校验
任何文件都是用二进制码表示的，通过vscode 插件hexdump查看图片文件的16进制表示，可以通过查看图片文件头信息来辨别文件类型。
常见的文件类型有png, jpg, gif。

JPG图片头信息: FFD8FF
PNG图片头信息: 89504E47
GIF图片头信息: 47494638
BMP图片头信息: 424D


## 文件指纹
场景：校验文件是否存在，对于上传的图片都必须是唯一的，需要设置唯一标识。
不能简单通过文件名检验，对文件内容使用md5加密得到唯一的字符串。

问题：对于大文件计算md5值需要很多的时间，如何解决这个问题？
### web-worker 结合 spark-md5
web-worker开启多个子线程计算md5，每个切片计算md5值然后追加。

### window.requestIdleCallback()
window.requestIdleCallback()方法将在浏览器的空闲时段内计算文件md5。
### hashMap抽样计算md5
hashMap，对文件切片，取首中尾三个切片的全部数据，然后合并再计算md5。

## 文件切片
前端将文件切成一些指定大小的块上传到后端，后端将切片合并。
## 断点续传
场景：由于网络通信故障，导致只上传了一部分，之后再上传只需要上传剩下的。
主要操作： 前端切片，分块上传，后端合并切片。

## 秒传
场景：文件已经存在，则不需要再上传，前端直接显示秒传成功。


## 异步任务并发数控制
场景：前端切片很多，会有大量的请求，会造成浏览器请求卡顿。

## 错误重试
场景：上传切片时，有些切片上传失败，会自动重新尝试有限次数。

## 慢启动
场景：文件的切片大小不是固定的，而是根据网络响应速度自动切换切片大小。借鉴了TCP策略。

## 思考
1. 碎片清理
2. 文件碎片存储在多个机器上
3. 文件碎片备份
4. 兼容性更好的requestIdleCallback
5. 并发+慢启动
6. 抽样hash+全量hash双重判断
7. websocket推送
8. cdn
# 登陆验证
前端页面注册，登录功能，调用service api，service端查询数据库。
## 注册功能
## 登陆功能
用户名密码验证： 
1. 简单的验证码。
2. token的管理，登陆以后的请求，都会自动带上token。
用户信息：
1. 信息的增删改查。
2. 头像文件上传。
## 用户验证
## 保存用户状态
1. session
2. jwt(json web token)
## 登录验证码
安装svg-captcha
```js
npm install -S svg-captcha
```

# 副文本编辑器