---
title: 单点登陆SSO
date: 2020-03-06 09:39:52
tags:
---
# 概念
单点登陆SSO(Single Sign On): 就是在多系统环境中实现,一次登陆,其他系统不再需要登陆也能协作.
实现单点登陆就是要解决如何产生和存储那个信任,再就是其他系统如何验证这个信任的有效性.
要点:
- 存储信任
- 验证信任

# 实现方式
## Cookie 为凭证媒介
最简单的单点登陆实现方式:是使用cookie作为媒介,存放用户凭证.用户登陆父应用之后,返回一个加密的cookie.当用户访问子应用的时候,携带上这个cookie,子应用解密cookie并进行校验,校验通过则登陆用户.
<img src="/static/img/sso_cookie.png">

问题:
1. cookie存储在客户端,不安全
2. 不能跨域实现免登陆.

## JSONP方式
对于跨域问题,可以使用JSONP实现.
用户在父应用中登录后，跟Session匹配的Cookie会存到客户端中，当用户需要登录子应用的时候，子应用访问父应用提供的JSONP接口，并在请求中带上父应用域名下的Cookie，父应用接收到请求，验证用户的登录状态，返回加密的信息，子应用通过解析返回来的加密信息来验证用户，如果通过验证则登录用户。
<img src="/static/img/sso_jsonp.png">

问题: 虽然能解决跨域问题但和cookie一样当cookie加密算法泄露,就能伪造响应请求.

## 页面重定向的方式
通过父应用和子应用来回重定向中进行通信，实现信息的安全传递。 
父应用提供一个GET方式的登录接口，用户通过子应用重定向连接的方式访问这个接口，如果用户还没有登录，则返回一个的登录页面，用户输入账号密码进行登录。如果用户已经登录了，则生成加密的Token，并且重定向到子应用提供的验证Token的接口，通过解密和校验之后，子应用登录当前用户。

<img src="/static/img/sso_redirect.png">


## 使用独立的登陆系统
大型应用会把授权的逻辑和用户信息的相关逻辑独立成一个应用,称为用户中心.用户中心不处理业务逻辑,只是处理用户信息的管理以及授权给第三方应用.第三方应用需要登陆的时候,则把用户的登陆请求转发给用户中心进行处理,用户处理完返回凭证,第三方应用验证凭证,通过后就可以登陆用户.