---
title: D3
date: 2020-11-05 16:42:38
tags: DS.js 数据驱动
---

# D3简介
D3 (或D3.js)简单来说就是一个数据驱动图形(DOM元素)的js库。内部可以使用svg和canvas来创造图形，通过绑定数据，来达到我们自己期望的效果，同时，D3还能满足我们的各种交互需求。

# D3特性
## 选择器
D3可以像JQuery一样去获取元素，它拥有丰富 的选择器。
```js
// select 选中第一个匹配的元素
const element = d3.select("div");

// selectAll 选中所有匹配的元素
const elementList = d3.selectAll("p");

// selectAll 和 select 组合使用
 const b = d3.selectAll("p").select("b");
```

## 创建元素
```js
// create 创建一个元素
const svg = d3.create("svg");
// append 在选择的元素中追加一个新元素
const svg = d3.select("body").append("svg");
const group = svg.append("g");
```

## 设置属性
```js
const elementList = d3.selectAll("p");

elementList.attr("class", 'className');
element.style("color", "red");
```

## 绑定数据
D3以数据为中心。
selection.data(data, keyFunc)
data方法第一个参数是数据数组，第二个参数是key函数，指定key函數，则提供了一种数据项和选择器DOM元素项之间的映射关系, 没有则默认使用元素的id属性。
```js
d3.selectAll("div")
  .data(data, function(d) { return d ? d.name : this.id; }) // 第一次绑定数据时，d为null，根据元素的id属性绑定。
  .text(d => d.number);
```
###  update, enter, exit
#### update 模式 - 更新元素属性
绑定数据选择器获取的元素节点个数和data数组中数据的个数相等时，就是进入到update模式。
```js
const div = d3.select("body")
  .selectAll("div")
  .data([4, 8, 15, 16, 23, 42])
  .text(d => d);
```
#### enter模式 - 新增元素
当选择器获取的元素节点个数小于 data数组中数据的个数时，需要为没有匹配到DOM元素的数据，分配一个占位的DOM元素,此时就进入了enter模式。
```js
const div = d3.select("body")
  .selectAll("div")
  .data([4, 8, 15, 16, 23, 42])
  .enter().append("div")
  .text(d => d);
```
#### exit模式 - 删除元素
当data数组中数据的个数小于 选择器获取的元素的个数时，需要执行删除DOM元素的操作，以保证元素个数和数据个数一致，此时就进入了exit模式。
```js
div.exit().remove();
```
### join
join是 前面提到的三种模式的快捷写法。默认enter和update的执行形式相同,默认exit是删除（remove）节点。
```js
var circle = svg.selectAll("circle")
  .data(data);

circle.exit().remove();

circle.enter().append("circle")
    .attr("r", 2.5)
  .merge(circle)
    .attr("cx", function(d) { return d.x; })
    .attr("cy", function(d) { return d.y; });
const data = [a,b,c,d,e,f,g];

// join 默认形式
svg.selectAll("text")
  .data(data)
  .join("text")
  .attr("x", (d, i) => i * 16)
  .text(d => d);

// join 定制
svg.selectAll("circle")
  .data(data)
  .join(
    enter => enter.append("circle"),
    update => update,
    exit => exit.remove()
  )
  .attr("fill", "none")
  .attr("stroke", "black");


```
## 绑定事件
```js
// 给p标签绑定点击事件， 回调函数中的this，就代表当前选中的元素
d3.selectAll("p").on("click", function(event) {
  d3.select(this).style("color", "red");
});
```
## 缩放 拖拽
## 动画
## 动态响应
```js
// 初始化
const renderInit = function (initData) {
  //code block 
}
// 更新
const renderUpdate = function (newData) {
  //code block 
}
```
# D3资源
1. github: https://github.com/d3/d3
2. 中文文档: https://github.com/d3/d3/wiki/API--%E4%B8%AD%E6%96%87%E6%89%8B%E5%86%8C
2. 整洁版: https://www.wenjiangs.com/doc/d3-get-start