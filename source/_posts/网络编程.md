---
title: 网络编程
date: 2020-01-06 14:25:47
tags:
---
# OSI模型(网络七层模型)
OSI(Open System Interconnection)模型,意为开放式系统互联.简单来说就是为了使计算机之间的通信标准化,然后划分出了网络七层模型,为了更好的理解网络通信如何工作.

基本划分:
七层划分: 物理层,数据链路层,网络层,传输层,会话层,表示层,应用层
五层划分: 物理层,数据链路层,网络层,传输层,应用层
四层划分: 网络接口层,网路层,传输层,应用层

在四层划分中,应用层包括了 应用层,表示层,会话层; 网络接口层包括了物理层,数据链路层
## 物理层
物理层主要是指硬件,包括网线,光纤,网卡,路由器,网络通信设备等硬件设备用来将计算机连接起来的物理手段.它规定了网络的一些电气特性,作用是负责传送0和1的电信号.

## 数据链路层 (以太网协议)
电信号中单纯的0和1是没有意义的,必须规定解读方式:多少个电信号为一组?每个电信号的有何意义?这就是数据链路层的功能,它在实体层的上方,确定了0和1 的分组方式.

数据链路层对电信号做分组,形成了以太网协议Ethernet.
数据链路层的工作方式--广播.

仅通过广播的方式,在数据链路层就可以完成同一局域网内通信,MAC地址之间通过广播的方式.但在不同的局域网之间实现跨网络通信,就需要在网络层了.

## 网络层 (IP协议)
网络层定义了IP协议.通过IP地址,可以知道你所在的局域网,通过MAC地址可以知道你在局域网内的地址.

在计算机通信时,会判断你所在的局域网,对方所在的局域网,如果在同一个局域网内,基于MAC地址广播发包就可以.

如果不在同一个局域网,即跨网络发包,就会先把你的包交给网关来转发.IP地址和MAC地址唯一标识了你在互联网中的位置.

数据链路层中会把网络层的数据包封装到数据链路层的数据位置，然后再添加上自己的包头，再发给物理层，物理层发给网关，网关再发给对方局域网的网关，对方局域网的网关收到后在那个局域网内做广播。

## 传输层 (TCP协议和UDP协议)
有了MAC地址和IP地址,我们还需要port端口号,表示这个数据包到底供哪个程序(进程)使用.

网络层的ip地址帮我们区分局域网,数据链路层的mac地址帮我们找到主机,传输层通过port端口标识主机上的应用程序.(端口即应用程序与网卡关联的编号).

传输层功能: 建立端口到端口的通信

端口范围: 0-65535,0-1023为系统占用端口.

传输层的两个重要协议:TCP协议和UDP协议
* TCP协议
面向连接的,占用资源多,速度相对较慢,提供可靠的数据传输服务

* UDP协议
无连接,占用资源较小,速度非常快不可靠的数据传输,这在一些对数据可靠性较低的场景中是非常有用的，比如音视频服务，物联网数据上报服务等.
## 会话层
负责建立和断开通信连接,以及数据的分割等数据传输相关的管理.(何时建立连接?何时断开连接?以及保持多久的连接)
## 表示层
设备固有的数据格式与网络标准数据格式之间的转换(接受不同的信息,如文字流,图像,声音)
## 应用层 (HTTP,SSH,FTP)
针对特定应用的协议,电子邮件协议E-mail,远程登陆协议SSH,文件传输协议FTP,网络请求协议HTTP.

# TCP协议-实现即时通讯IM
* Socket实现
原理: Net模块提供一个异步API能够创建基于流的TCP服务器,客户端与服务器建立连接后,服务器可以获得一个全双工Socket对象,服务器可以保存Socket对象列表,在接受某客户端消息时,推送给其他客户端.
```js
const net = require('net')
const chatServer = net.createServer()
const clientList = []
chatServer.on('connection', client => {
    client.write('Hi\n')
    clientList.push(client)
    client.on('data', data => {
        console.log('receive: ', data.toString())
        clientList.forEach(v => {
            v.write(data)
        })
    })
})
chatServer.listen(9000)
```
通过telnet连接服务器,命令行输出如下命令
```
telnet localhost 9000
```

# 跨域:浏览器同源策略引起的接口调用问题
跨域产生的原因:
1. 浏览器同源策略
2. 页面发送ajax请求

## 同源策略
浏览器规定两个资源之间进行交互,这两个资源必须处于相同的协议(http,https),相同的主机(host),相同的端口(port),这就称两个资源同源.

## 跨源网络访问
当一个页面使用了ajax请求另一不同源的网站数据,浏览器就会提示以下错误:
```
XMLHttpRequest cannot load http://你请求的域名. No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'http://当前页的域名' is therefore not allowed access.
```
## 解决跨域问题
* 使用jsonp
* 服务端代理
* 服务端设置Request Header头中Access-Control-Allow-Origin为指定可获取数据的域名.